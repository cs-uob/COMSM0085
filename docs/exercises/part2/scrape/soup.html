<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>BeautifulSoup - Exercises</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../overview.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Week 6: The Web</li><li class="chapter-item expanded "><a href="../http/index.html"><strong aria-hidden="true">1.</strong> HTTP</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../http/setup.html"><strong aria-hidden="true">1.1.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../http/explore.html"><strong aria-hidden="true">1.2.</strong> Exploring HTTP</a></li><li class="chapter-item expanded "><a href="../http/research.html"><strong aria-hidden="true">1.3.</strong> Online research</a></li><li class="chapter-item expanded "><a href="../http/server.html"><strong aria-hidden="true">1.4.</strong> A server in Java</a></li></ol></li><li class="chapter-item expanded "><a href="../html5/index.html"><strong aria-hidden="true">2.</strong> HTML5</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../html5/basic.html"><strong aria-hidden="true">2.1.</strong> Basic HTML5</a></li><li class="chapter-item expanded "><a href="../html5/templates.html"><strong aria-hidden="true">2.2.</strong> Templates</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Week 7: CSS</li><li class="chapter-item expanded "><a href="../css/index.html"><strong aria-hidden="true">3.</strong> CSS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../css/text.html"><strong aria-hidden="true">3.1.</strong> Styling Text</a></li><li class="chapter-item expanded "><a href="../css/framework.html"><strong aria-hidden="true">3.2.</strong> Frameworks</a></li></ol></li><li class="chapter-item expanded "><a href="../cssgrid/index.html"><strong aria-hidden="true">4.</strong> CSS grids</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cssgrid/intro.html"><strong aria-hidden="true">4.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../cssgrid/curriculum.html"><strong aria-hidden="true">4.2.</strong> Curriculum exercise</a></li><li class="chapter-item expanded "><a href="../cssgrid/trees.html"><strong aria-hidden="true">4.3.</strong> Trees exercise (responsive layout)</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Week 8: Javascript</li><li class="chapter-item expanded "><a href="../js/index.html"><strong aria-hidden="true">5.</strong> JavaScript</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../js/MyCoolApp.html"><strong aria-hidden="true">5.1.</strong> My Cool App</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Week 9: Web Scraping</li><li class="chapter-item expanded "><a href="../scrape/index.html"><strong aria-hidden="true">6.</strong> Web scraping</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../scrape/crawl.html"><strong aria-hidden="true">6.1.</strong> Crawling</a></li><li class="chapter-item expanded "><a href="../scrape/soup.html" class="active"><strong aria-hidden="true">6.2.</strong> BeautifulSoup</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Week 10: Practical Encryption</li><li class="chapter-item expanded "><a href="../encryption/index.html"><strong aria-hidden="true">7.</strong> Practical Encryption</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../encryption/openssl.html"><strong aria-hidden="true">7.1.</strong> OpenSSL</a></li><li class="chapter-item expanded "><a href="../encryption/pgp.html"><strong aria-hidden="true">7.2.</strong> PGP</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Exercises</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="beautifulsoup"><a class="header" href="#beautifulsoup">BeautifulSoup</a></h1>
<p>Previously in this unit we have taught you how to construct webpages, including how
to construct webpages so that they present structured information (e.g., the
contents of a database). The presumption has generally been that you are
designing webpages for (usually visual) consumption by a human using a standard
web browser, or at most writing Javascript functions that will help a human use
a webpage in particular way.</p>
<p>However, there are situations where you may need to write code that interacts
with webpages in an automated fashion -- perhaps to extract some data from webpages
that isn't available in a more machine-friendly format. This <em>scraping</em> of
webpages is a valuable (if sometimes maliciously applied) skill that can be
useful to many kinds of software engineers and data scientists. This exercise
talks you through some applications of one of the most common frameworks, a
Python library called BeautifulSoup.</p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>First, you want to install the BeautifulSoup library, which you can achieve with
<code>sudo apt install python3-bs4</code>. Python does have its own package manager, <code>pip</code>,
but it would get in the way of our system-wide package management to use it here.</p>
<p>You can test that Python is working by just typing <code>python3</code> at the command line
-- it should launch the interactive interpreter, which will prompt you for
Python code with <code>&gt;&gt;&gt;</code>. Type <code>from bs4 import BeautifulSoup</code>. If this completes
then you've successfully imported the library.</p>
<h2 id="interacting-with-soup"><a class="header" href="#interacting-with-soup">Interacting with Soup</a></h2>
<p>Next, enter something like the following:</p>
<pre><code class="language-python">file = "cattax/index.html"
soup = BeautifulSoup(open(file, 'r'))
</code></pre>
<p><em>(You may need to change the 'file' line to reflect where the <code>cattax/index.html</code>
file really is relative to where you launched <code>python3</code>. Also, if you close the
interpreter at any point remember you'll need to re-run the <code>import</code> line above
to get the library).</em></p>
<p>You now have a 'soup' object, which is a Python object that has various methods
for interacting with HTML (and XML) documents and accessing their contents. To
start with, just type <code>soup</code> in your interpreter. Python will print out the
basic textual representation of the object, which is just the source of the
<code>index.html</code> page. Next, let's attempt one of the commonest use-cases for scraping.</p>
<pre><code class="language-python">soup.get_text()
</code></pre>
<p>You should see a string containing the textual content of the webpage. If you
call <code>print</code> on the result, you should see that the text has been laid out in a
fair approximation of how the visible text would appear on a webpage.</p>
<pre><code class="language-python">text = soup.get_text()
print(text)
</code></pre>
<p>Getting the visible text out of a page is a common requirement if, e.g., you
were going to use the webpage as input to an NLP system. You can also access
non-visible portions of the page -- <code>soup.title</code> will give you the title element
of the webpage, and <code>soup.title.text</code> will get you the textual content within
the title element. Note the difference: <code>soup.title</code> is a BeautifulSoup element
(of type <code>Tag</code>), and has methods associated with being a tag; <code>soup.title.text</code>
is just a string, and only has methods that apply to strings.</p>
<p>As HTML documents are structured, you can interact with them in a structured
manner. <code>soup.head</code> will get you a soup object reflecting the 'head' part of
the HTML structure, and <code>soup.head.findChildren()</code> will return a list containing
all of the 'children' elements inside the head. By knowing the structure of the
document you can thus navigate to certain elements programmatically. This
doesn't just relate to the tags, either: you can also access the value of
attributes. <code>soup.head.meta['charset']</code> would access the <code>charset</code> attribute of
the meta tag in the head of the document.</p>
<h3 id="exercises"><a class="header" href="#exercises">Exercises</a></h3>
<ol>
<li>Take a look at some other examples from <a href="https://beautiful-soup-4.readthedocs.io/en/latest/#navigating-the-tree">the BeautifulSoup documentation</a>, in particular regarding the use of the <code>.find_all()</code> method.</li>
<li>Use your interpreter to access a list of all the <code>&lt;strong&gt;</code> elements in the
webpage, and figure out how to print out just the text contained within them.</li>
<li>How would you use <code>.find_all()</code> to find all <code>&lt;div&gt;</code> elements with a
particular class value (e.g., 'container')? Would your method work if the div
had multiple classes?</li>
</ol>
<h2 id="a-scraping-script"><a class="header" href="#a-scraping-script">A Scraping Script</a></h2>
<p>Download <a href="../resources/scrape.py">this python script</a> to the directory that
contains your <code>cattax</code> folder (<em>not</em> into <code>cattax</code> itself). On the command line,
you should be able to run this script with <code>python3 scrape.py</code>. You'll see that
it prints out a series of lines related to all the files in <code>cattax</code>.</p>
<p>Open <code>scrape.py</code> in an editor and inspect what it is doing. The script imports
two libraries, one is BeautifulSoup and the other is <code>os</code>, which allows the
script to use certain operating system functions. <code>os.listdir</code> is then used to list the
contents of our <code>cattax</code> directory and iterate over them. We filter the
filenames by checking to see which of them end with the string 'html', and if
they do then we open the file and parse it into a BeautifulSoup object. Then, we
print out text from certain elements, separated by a ':'. Understand how this
works, asking a TA or lecturer for help if you aren't sure.</p>
<h3 id="exercises-1"><a class="header" href="#exercises-1">Exercises</a></h3>
<ol>
<li>Modify <code>scrape.py</code> so that it <em>also</em> prints out the contents of the 'info'
paragraph in each page (this can be a second print statement). Run the script
again to test that it works.</li>
<li>Currently the script prints something for <em>every</em> page. Modify it so it would
only print something out for the leaf nodes -- those pages that don't have a
'container' element of their own.</li>
<li>Printing things out can be useful, but often we want to store values we
scrape for later programmatic work. Rather than printing out information,
create and update a <a href="https://realpython.com/python-dicts/">Python dict</a> for all
leaf nodes where the dictionary keys are the titles of a page and the values are
the corresponding content of the 'info' box. <em>Run your script with <code>python3 -i scrape.py</code> and it will execute your script and then place you in an interactive
session immediately following your script's execution. You can then check that
the dictionary's contents are what you expect by interacting with the dict
object in your interpreter.</em></li>
</ol>
<h2 id="when-to-scrape"><a class="header" href="#when-to-scrape">When to scrape</a></h2>
<p>As we discuss in this week's lectures, scraping webpages can come with some
risks, depending upon how you go about it and what you do with the results.
Guidelines you should follow include:</p>
<ul>
<li>Always respect the <a href="https://developers.google.com/search/docs/crawling-indexing/robots/robots_txt">robots.txt</a> presented by a site. Resources denied to crawlers may be protected for a legal or ethical reason.</li>
<li>Always look for an API first. If a site will provide you with a JSON endpoint
to query for the structured data you want, it is both easier and more polite
to use that API instead of scraping the same data from webpages designed for
human consumption.</li>
<li>Be very careful about any scraping behind an authenticated log-in, such as
from a logged-in social media account. Think about the privacy expectations
people have about the content you are collecting, both in legal and ethical
terms. If you post publicly something that was intended only for a limited
audience, you could be betraying a confidence, and might even face legal
repercussions.</li>
<li>Generally beware that being able to access and read information from the web
does not mean you are permitted to republish it, even in a modified form.</li>
</ul>
<h2 id="further-reading"><a class="header" href="#further-reading">Further reading</a></h2>
<p>You may have noticed that we downloaded our webpages with <code>wget</code> in the previous
exercise, and then dealt with their content using Python in this one. If you
were writing a Python tool that was meant to do something specific with the
content of a webpage, then you would often want to avoid using a second tool,
and make web requests directly from your program.
The Python library that is most often recommended for requesting web resources
is the <a href="https://docs.python-requests.org/en/latest/">Requests library</a>, and
getting familiar with it would be useful both if you wanted to access web pages
programmatically and if you need to interact with a website's API.</p>
<p>We've also been dealing with the content of <em>static</em> websites, without the dynamic
content like that you learned about in the Javascript exercises. Scraping
dynamic sites gets trickier, as your scraper needs to have a browser-like
context to execute Javascript within, and often might need to pretend to
interact with the page. Systems like <a href="https://www.selenium.dev/documentation/">Selenium</a>
are designed for cases like this.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../scrape/crawl.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../encryption/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../scrape/crawl.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../encryption/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
